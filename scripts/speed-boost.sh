#!/bin/bash

echo "‚ö° –£–°–ö–û–†–ï–ù–ò–ï –ó–ê–ì–†–£–ó–ö–ò –ë–ê–õ–ê–ù–°–û–í"
echo "==============================="
echo ""

# –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—â–µ–Ω
if ! curl -s http://localhost:3000/api/cache-stats > /dev/null 2>&1; then
    echo "‚ùå –°–µ—Ä–≤–µ—Ä –Ω–µ –∑–∞–ø—É—â–µ–Ω!"
    echo "üöÄ –ó–∞–ø—É—Å—Ç–∏—Ç–µ: npm run dev"
    exit 1
fi

echo "üî• –ü—Ä–∏–º–µ–Ω—è—é –≤—Å–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –¥–ª—è —É—Å–∫–æ—Ä–µ–Ω–∏—è..."

# 1. –û—á–∏—Å—Ç–∫–∞ –∫–µ—à–∞ –±–∞–ª–∞–Ω—Å–æ–≤ 
echo "1Ô∏è‚É£ –û—á–∏—â–∞—é –∫–µ—à –±–∞–ª–∞–Ω—Å–æ–≤ —Ç–æ–∫–µ–Ω–æ–≤..."
curl -s -X POST http://localhost:3000/api/cache-stats \
  -H "Content-Type: application/json" \
  -d '{"action": "clear", "type": "TOKEN_BALANCE"}' | jq '.message' 2>/dev/null || echo "–û—á–∏—â–µ–Ω–æ"

# 2. –û—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π
echo "2Ô∏è‚É£ –£–¥–∞–ª—è—é —É—Å—Ç–∞—Ä–µ–≤—à–∏–µ –∑–∞–ø–∏—Å–∏..."
curl -s -X POST http://localhost:3000/api/cache-stats \
  -H "Content-Type: application/json" \
  -d '{"action": "cleanup"}' | jq '.message' 2>/dev/null || echo "–û—á–∏—â–µ–Ω–æ"

# 3. –°–±–æ—Ä–∫–∞ –º—É—Å–æ—Ä–∞
echo "3Ô∏è‚É£ –ó–∞–ø—É—Å–∫–∞—é —Å–±–æ—Ä–∫—É –º—É—Å–æ—Ä–∞..."
curl -s -X POST http://localhost:3000/api/cache-stats \
  -H "Content-Type: application/json" \
  -d '{"action": "gc"}' | jq '.message' 2>/dev/null || echo "–í—ã–ø–æ–ª–Ω–µ–Ω–æ"

echo ""
echo "‚úÖ –û–ü–¢–ò–ú–ò–ó–ê–¶–ò–ò –ü–†–ò–ú–ï–ù–ï–ù–´!"
echo ""
echo "üìä –¢–µ–∫—É—â–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –∫–µ—à–∞:"
curl -s http://localhost:3000/api/cache-stats | jq '.cache // .' 2>/dev/null || curl -s http://localhost:3000/api/cache-stats

echo ""
echo "üéØ –†–µ–∑—É–ª—å—Ç–∞—Ç:"
echo "  ‚Ä¢ –†–∞–∑–º–µ—Ä –±–∞—Ç—á–µ–π —É–≤–µ–ª–∏—á–µ–Ω —Å 8 –¥–æ 20 –∫–æ—à–µ–ª—å–∫–æ–≤"
echo "  ‚Ä¢ –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –±–∞—Ç—á–µ–π"
echo "  ‚Ä¢ TTL –∫–µ—à–∞ —É–≤–µ–ª–∏—á–µ–Ω —Å 5 –¥–æ 10 –º–∏–Ω—É—Ç"
echo "  ‚Ä¢ –¢–∞–π–º–∞—É—Ç—ã —É–º–µ–Ω—å—à–µ–Ω—ã —Å 8 –¥–æ 5 —Å–µ–∫—É–Ω–¥"
echo ""
echo "‚ö° –ó–∞–≥—Ä—É–∑–∫–∞ –±–∞–ª–∞–Ω—Å–æ–≤ –¥–æ–ª–∂–Ω–∞ —Å—Ç–∞—Ç—å –≤ 3-5 —Ä–∞–∑ –±—ã—Å—Ç—Ä–µ–µ!"
echo "" 