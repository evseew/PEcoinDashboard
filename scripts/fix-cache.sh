#!/bin/bash

# –°–∫—Ä–∏–ø—Ç –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–æ–±–ª–µ–º —Å –∫—ç—à–µ–º Next.js
# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: ./scripts/fix-cache.sh [dev|build|full]

echo "üßπ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º —Å –∫—ç—à–µ–º Next.js..."

# –§—É–Ω–∫—Ü–∏—è –æ—á–∏—Å—Ç–∫–∏ –±–∞–∑–æ–≤–æ–≥–æ –∫—ç—à–∞
clean_basic() {
    echo "–£–¥–∞–ª–µ–Ω–∏–µ .next –∫—ç—à–∞..."
    rm -rf .next
    
    echo "–£–¥–∞–ª–µ–Ω–∏–µ node_modules –∫—ç—à–∞..."
    rm -rf node_modules/.cache
    
    echo "‚úÖ –ë–∞–∑–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
}

# –§—É–Ω–∫—Ü–∏—è –ø–æ–ª–Ω–æ–π –æ—á–∏—Å—Ç–∫–∏
clean_full() {
    clean_basic
    
    echo "–£–¥–∞–ª–µ–Ω–∏–µ –≤—Å–µ—Ö node_modules..."
    rm -rf node_modules
    
    echo "–ü–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
    pnpm install
    
    echo "‚úÖ –ü–æ–ª–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤
case "${1:-dev}" in
    "dev")
        clean_basic
        echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
        pnpm dev
        ;;
    "build")
        clean_basic
        echo "üî® –ó–∞–ø—É—Å–∫ —Å–±–æ—Ä–∫–∏..."
        pnpm build
        ;;
    "full")
        clean_full
        echo "üöÄ –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏..."
        pnpm dev
        ;;
    *)
        echo "–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ: $0 [dev|build|full]"
        echo "  dev   - –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ + –∑–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞ (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é)"
        echo "  build - –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–∞ + —Å–±–æ—Ä–∫–∞"
        echo "  full  - –ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ—É—Å—Ç–∞–Ω–æ–≤–∫–∞ + –∑–∞–ø—É—Å–∫ dev —Å–µ—Ä–≤–µ—Ä–∞"
        exit 1
        ;;
esac 